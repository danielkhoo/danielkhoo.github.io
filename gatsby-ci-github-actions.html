<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Deploy Gatsby on commit with Github Actions</title><link href="https://unpkg.com/prismjs@0.0.1/themes/prism.css" rel="stylesheet"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/d8927090da2796e4b04f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d8927090da2796e4b04f.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-af6cbf6fc52c81a80770.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.2113c6061a2f456066a1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.19cccdec09c9bab0f3c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-08c26918681e48ad267f.js" as="script"/><link rel="preload" href="/_next/static/chunks/753213a97911e179639534de0b0514414e7c9ca7.992ebdeb70dfb1b08a43.js" as="script"/><link rel="preload" href="/_next/static/chunks/e62dc9f6a11d84dfddaca06be4756b049d146996.e784b9ff6f8277ce7724.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/%5Bslug%5D-3798cc19cf92eb70fbcd.js" as="script"/></head><body><div id="__next"><div class="min-h-screen flex flex-col justify-start items-center font-sans"><div class="max-w-screen-md w-full min-h-screen"><nav class="w-full h-16 flex flex-row justify-start items-center"><a class="w-24 h-full flex justify-center items-center no-underline font-medium hover:text-primary 
      text-gray" href="/">About</a><a class="w-24 h-full flex justify-center items-center no-underline font-medium hover:text-primary
      text-primary" href="/blog">Blog</a><a class="w-24 h-full flex justify-center items-center no-underline font-medium hover:text-primary 
      text-gray" href="/projects">Projects</a></nav><main class="mx-6 my-12"><div class="my-12"><h3 class="text-lg text-gray"><time dateTime="2019-12-16T00:00:00.000Z">Dec 2019</time></h3><h1>Deploy Gatsby on commit with Github Actions</h1></div><div class="text-lg"><h2>The Dumb Way</h2>
<p>For the longest time, ever since I first learned about Github Actions, I've wanted a quick easy way to automate deployment for this Gatsby blog.</p>
<p>The idea is simple yet beautiful.</p>
<ol>
<li>Edit Markdown</li>
<li>Commit</li>
<li><em>Magic</em></li>
</ol>
<p>Gatsby build already deploys static files, so the only real challenge is pushing it to the github.io repo. Of course the lazy way is simply to git init in the directory, set origin and <em><strong>FORCE PUSH!!!!</strong></em>.</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash"><span class="token string">"deploy"</span><span class="token builtin class-name">:</span> <span class="token string">"gatsby build &#x26;&#x26; cd public &#x26;&#x26; git add . &#x26;&#x26; git commit -m 'deploy' &#x26;&#x26; git push --force"</span>
</code></pre></div>
<p><em><em>Obi wan has taught me well</em></em></p>
<h2>The Fancy Way</h2>
<p>The previous way works, but it's not very pretty. Kinda like hammering a nail with a big rock. Why are we building and pushing the artifacts locally when we have fancy <em>Github Actions</em> to do this for us?</p>
<p>Turns out setting up a github action is really simple. All you need is a YAML file.</p>
<p><code>.github/deploy.yml</code></p>
<div class="remark-highlight"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> CI <span class="token punctuation">-</span> Build and Deploy to Github Pages Repo
<span class="token key atrule">on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>push<span class="token punctuation">]</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
<span class="token key atrule">build</span><span class="token punctuation">:</span>
<span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v1
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">          npm install</span>
<span class="token scalar string">          npm run build</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string"></span>
<span class="token scalar string">          cd ${{ github.workspace }}/public</span>
<span class="token scalar string">          git init</span>
<span class="token scalar string">          git add .</span>
<span class="token scalar string">          git config --local user.email "action@github.com"</span>
<span class="token scalar string">          git config --local user.name "GitHub Action"</span>
<span class="token scalar string">          git commit -m "Build artifacts"</span>
<span class="token scalar string">          git remote add origin https://$ACCESS_TOKEN@github.com/danielkhoo/danielkhoo.github.io.git</span>
<span class="token scalar string">          git push --set-upstream origin master --force</span>
</code></pre></div>
<p>Note that I had to generate a separate ACCESS_TOKEN to access the other repo.</p>
<p><code>GitHub Settings / Developer settings / Personal access tokens</code></p>
<p>Once generated, add it as a secret in the current repo under <code>Settings / Secrets</code></p>
<blockquote>
<p>And that's it! Automatic Gatsby build and deploy on push. Magic</p>
</blockquote>
<p><img src="./ss2.png" alt="CI"></p>
</div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Deploy Gatsby on commit with Github Actions","date":"2019-12-16T00:00:00.000Z","slug":"gatsby-ci-github-actions","content":"\u003ch2\u003eThe Dumb Way\u003c/h2\u003e\n\u003cp\u003eFor the longest time, ever since I first learned about Github Actions, I've wanted a quick easy way to automate deployment for this Gatsby blog.\u003c/p\u003e\n\u003cp\u003eThe idea is simple yet beautiful.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eEdit Markdown\u003c/li\u003e\n\u003cli\u003eCommit\u003c/li\u003e\n\u003cli\u003e\u003cem\u003eMagic\u003c/em\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eGatsby build already deploys static files, so the only real challenge is pushing it to the github.io repo. Of course the lazy way is simply to git init in the directory, set origin and \u003cem\u003e\u003cstrong\u003eFORCE PUSH!!!!\u003c/strong\u003e\u003c/em\u003e.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003e\u003cspan class=\"token string\"\u003e\"deploy\"\u003c/span\u003e\u003cspan class=\"token builtin class-name\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"gatsby build \u0026#x26;\u0026#x26; cd public \u0026#x26;\u0026#x26; git add . \u0026#x26;\u0026#x26; git commit -m 'deploy' \u0026#x26;\u0026#x26; git push --force\"\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cem\u003e\u003cem\u003eObi wan has taught me well\u003c/em\u003e\u003c/em\u003e\u003c/p\u003e\n\u003ch2\u003eThe Fancy Way\u003c/h2\u003e\n\u003cp\u003eThe previous way works, but it's not very pretty. Kinda like hammering a nail with a big rock. Why are we building and pushing the artifacts locally when we have fancy \u003cem\u003eGithub Actions\u003c/em\u003e to do this for us?\u003c/p\u003e\n\u003cp\u003eTurns out setting up a github action is really simple. All you need is a YAML file.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e.github/deploy.yml\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-yaml\"\u003e\u003ccode class=\"language-yaml\"\u003e\u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e CI \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e Build and Deploy to Github Pages Repo\n\u003cspan class=\"token key atrule\"\u003eon\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003epush\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"token key atrule\"\u003ejobs\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003ebuild\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003cspan class=\"token key atrule\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e ubuntu\u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003elatest\n\n    \u003cspan class=\"token key atrule\"\u003esteps\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003euses\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e actions/checkout@v1\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Build\n        \u003cspan class=\"token key atrule\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e|\u003c/span\u003e\u003cspan class=\"token scalar string\"\u003e\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          npm install\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          npm run build\u003c/span\u003e\n\n      \u003cspan class=\"token punctuation\"\u003e-\u003c/span\u003e \u003cspan class=\"token key atrule\"\u003ename\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e Deploy\n        \u003cspan class=\"token key atrule\"\u003eenv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n          \u003cspan class=\"token key atrule\"\u003eACCESS_TOKEN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e $\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e secrets.ACCESS_TOKEN \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"token key atrule\"\u003erun\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e|\u003c/span\u003e\u003cspan class=\"token scalar string\"\u003e\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          cd ${{ github.workspace }}/public\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git init\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git add .\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git config --local user.email \"action@github.com\"\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git config --local user.name \"GitHub Action\"\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git commit -m \"Build artifacts\"\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git remote add origin https://$ACCESS_TOKEN@github.com/danielkhoo/danielkhoo.github.io.git\u003c/span\u003e\n\u003cspan class=\"token scalar string\"\u003e          git push --set-upstream origin master --force\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eNote that I had to generate a separate ACCESS_TOKEN to access the other repo.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGitHub Settings / Developer settings / Personal access tokens\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eOnce generated, add it as a secret in the current repo under \u003ccode\u003eSettings / Secrets\u003c/code\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eAnd that's it! Automatic Gatsby build and deploy on push. Magic\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"./ss2.png\" alt=\"CI\"\u003e\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/[slug]","query":{"slug":"gatsby-ci-github-actions"},"buildId":"6Mdaw5qn8blG-sIBpostI","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4beebf4ac9054f0bf4e6.js"></script><script src="/_next/static/chunks/main-af6cbf6fc52c81a80770.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.2113c6061a2f456066a1.js" async=""></script><script src="/_next/static/chunks/commons.19cccdec09c9bab0f3c3.js" async=""></script><script src="/_next/static/chunks/pages/_app-08c26918681e48ad267f.js" async=""></script><script src="/_next/static/chunks/753213a97911e179639534de0b0514414e7c9ca7.992ebdeb70dfb1b08a43.js" async=""></script><script src="/_next/static/chunks/e62dc9f6a11d84dfddaca06be4756b049d146996.e784b9ff6f8277ce7724.js" async=""></script><script src="/_next/static/chunks/pages/%5Bslug%5D-3798cc19cf92eb70fbcd.js" async=""></script><script src="/_next/static/6Mdaw5qn8blG-sIBpostI/_buildManifest.js" async=""></script><script src="/_next/static/6Mdaw5qn8blG-sIBpostI/_ssgManifest.js" async=""></script></body></html>